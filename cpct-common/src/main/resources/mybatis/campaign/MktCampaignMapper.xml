<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zjtelcom.cpct.dao.campaign.MktCampaignMapper">
    <resultMap id="BaseResultMap" type="com.zjtelcom.cpct.domain.campaign.MktCampaignDO">
        <id column="MKT_CAMPAIGN_ID" jdbcType="BIGINT" property="mktCampaignId"/>
        <result column="TIGGER_TYPE" jdbcType="VARCHAR" property="tiggerType"/>
        <result column="MKT_CAMPAIGN_NAME" jdbcType="VARCHAR" property="mktCampaignName"/>
        <result column="PLAN_BEGIN_TIME" jdbcType="DATE" property="planBeginTime"/>
        <result column="PLAN_END_TIME" jdbcType="DATE" property="planEndTime"/>
        <result column="BEGIN_TIME" jdbcType="DATE" property="beginTime"/>
        <result column="END_TIME" jdbcType="DATE" property="endTime"/>
        <result column="MKT_CAMPAIGN_TYPE" jdbcType="VARCHAR" property="mktCampaignType"/>
        <result column="MKT_CAMPAIGN_CATEGORY" jdbcType="VARCHAR" property="mktCampaignCategory" />
        <result column="MKT_ACTIVITY_NBR" jdbcType="VARCHAR" property="mktActivityNbr"/>
        <result column="MKT_ACTIVITY_TARGET" jdbcType="VARCHAR" property="mktActivityTarget"/>
        <result column="MKT_CAMPAIGN_DESC" jdbcType="VARCHAR" property="mktCampaignDesc"/>
        <result column="CALC_DISPLAY" jdbcType="BIGINT" property="calcDisplay" />
        <result column="ISALE_DISPLAY" jdbcType="BIGINT" property="isaleDisplay" />
        <result column="EXEC_TYPE" jdbcType="VARCHAR" property="execType"/>
        <result column="EXEC_INVL" jdbcType="VARCHAR" property="execInvl"/>
        <result column="EXEC_NUM" jdbcType="INTEGER" property="execNum"/>
        <result column="STATUS_CD" jdbcType="VARCHAR" property="statusCd"/>
        <result column="STATUS_DATE" jdbcType="TIMESTAMP" property="statusDate"/>
        <result column="CREATE_STAFF" jdbcType="BIGINT" property="createStaff"/>
        <result column="CREATE_DATE" jdbcType="TIMESTAMP" property="createDate"/>
        <result column="UPDATE_STAFF" jdbcType="BIGINT" property="updateStaff"/>
        <result column="UPDATE_DATE" jdbcType="TIMESTAMP" property="updateDate"/>
        <result column="REMARK" jdbcType="VARCHAR" property="remark"/>
        <result column="LAN_ID" jdbcType="BIGINT" property="lanId"/>
        <result column="CREATE_CHANNEL" jdbcType="VARCHAR" property="createChannel" />
        <result column="DIRECTORY_ID" jdbcType="BIGINT" property="directoryId" />
        <result column="CAM_LEVEL" jdbcType="BIGINT" property="camLevel" />
    </resultMap>

    <resultMap id="countResultMap" type="com.zjtelcom.cpct.domain.campaign.MktCampaignCountDO">
        <id column="MKT_CAMPAIGN_ID" jdbcType="BIGINT" property="mktCampaignId"/>
        <result column="TIGGER_TYPE" jdbcType="VARCHAR" property="tiggerType"/>
        <result column="MKT_CAMPAIGN_NAME" jdbcType="VARCHAR" property="mktCampaignName"/>
        <result column="PLAN_BEGIN_TIME" jdbcType="DATE" property="planBeginTime"/>
        <result column="PLAN_END_TIME" jdbcType="DATE" property="planEndTime"/>
        <result column="MKT_CAMPAIGN_TYPE" jdbcType="VARCHAR" property="mktCampaignType"/>
        <result column="MKT_CAMPAIGN_CATEGORY" jdbcType="VARCHAR" property="mktCampaignCategory" />
        <result column="MKT_ACTIVITY_NBR" jdbcType="VARCHAR" property="mktActivityNbr"/>
        <result column="STATUS_CD" jdbcType="VARCHAR" property="statusCd"/>
        <result column="LAN_ID" jdbcType="BIGINT" property="lanId"/>
        <result column="CREATE_CHANNEL" jdbcType="VARCHAR" property="createChannel" />
        <result column="REL_COUNT" javaType="INT" property="relCount" />
        <result column="A_MKT_CAMPAIGN_ID" jdbcType="BIGINT" property="preMktCampaignId"/>
        <result column="CREATE_DATE" jdbcType="TIMESTAMP" property="createDate"/>
        <result column="UPDATE_DATE" jdbcType="TIMESTAMP" property="updateDate"/>
    </resultMap>

    <delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
      delete from mkt_campaign
      where MKT_CAMPAIGN_ID = #{mktCampaignId,jdbcType=BIGINT}
    </delete>

    <insert id="insert" parameterType="com.zjtelcom.cpct.domain.campaign.MktCampaignDO" useGeneratedKeys="true"
            keyProperty="mktCampaignId">
    insert into mkt_campaign (MKT_CAMPAIGN_ID, TIGGER_TYPE, MKT_CAMPAIGN_NAME,
      PLAN_BEGIN_TIME, PLAN_END_TIME, BEGIN_TIME,
      END_TIME, MKT_CAMPAIGN_TYPE, MKT_CAMPAIGN_CATEGORY,
      MKT_ACTIVITY_NBR, MKT_ACTIVITY_TARGET, MKT_CAMPAIGN_DESC,
      CALC_DISPLAY,ISALE_DISPLAY,
      EXEC_TYPE, EXEC_INVL, EXEC_NUM,
      STATUS_CD, STATUS_DATE, CREATE_STAFF,
      CREATE_DATE, UPDATE_STAFF, UPDATE_DATE,
      REMARK, LAN_ID, CREATE_CHANNEL, DIRECTORY_ID, CAM_LEVEL)
    values (#{mktCampaignId,jdbcType=BIGINT}, #{tiggerType,jdbcType=VARCHAR}, #{mktCampaignName,jdbcType=VARCHAR},
      #{planBeginTime,jdbcType=DATE}, #{planEndTime,jdbcType=DATE}, #{beginTime,jdbcType=DATE},
      #{endTime,jdbcType=DATE}, #{mktCampaignType,jdbcType=VARCHAR}, #{mktCampaignCategory,jdbcType=VARCHAR},
      #{mktActivityNbr,jdbcType=VARCHAR}, #{mktActivityTarget,jdbcType=VARCHAR}, #{mktCampaignDesc,jdbcType=VARCHAR},
      #{calcDisplay,jdbcType=BIGINT}, #{isaleDisplay,jdbcType=BIGINT},
      #{execType,jdbcType=VARCHAR}, #{execInvl,jdbcType=VARCHAR}, #{execNum,jdbcType=INTEGER},
      #{statusCd,jdbcType=VARCHAR}, #{statusDate,jdbcType=TIMESTAMP}, #{createStaff,jdbcType=BIGINT},
      #{createDate,jdbcType=TIMESTAMP}, #{updateStaff,jdbcType=BIGINT}, #{updateDate,jdbcType=TIMESTAMP},
      #{remark,jdbcType=VARCHAR}, #{lanId,jdbcType=BIGINT}, #{createChannel,jdbcType=VARCHAR},
      #{directoryId,jdbcType=BIGINT},#{camLevel,jdbcType=BIGINT})
    </insert>

    <update id="updateByPrimaryKey" parameterType="com.zjtelcom.cpct.domain.campaign.MktCampaignDO">
      update mkt_campaign
   set  <if test= "tiggerType!=null">TIGGER_TYPE = #{tiggerType,jdbcType=VARCHAR},</if>
        <if test= "mktCampaignName!=null">MKT_CAMPAIGN_NAME = #{mktCampaignName,jdbcType=VARCHAR},</if>
        <if test= "planBeginTime!=null">PLAN_BEGIN_TIME = #{planBeginTime,jdbcType=DATE},</if>
        <if test= "planEndTime!=null">PLAN_END_TIME = #{planEndTime,jdbcType=DATE},</if>
        <if test= "beginTime!=null">BEGIN_TIME = #{beginTime,jdbcType=DATE},</if>
        <if test= "endTime!=null">END_TIME = #{endTime,jdbcType=DATE},</if>
        <if test= "mktCampaignType!=null">MKT_CAMPAIGN_TYPE = #{mktCampaignType,jdbcType=VARCHAR},</if>
        <if test= "mktCampaignCategory!=null">MKT_CAMPAIGN_CATEGORY = #{mktCampaignCategory,jdbcType=VARCHAR},</if>
        <if test= "mktActivityNbr!=null">MKT_ACTIVITY_NBR = #{mktActivityNbr,jdbcType=VARCHAR},</if>
        <if test= "mktActivityTarget!=null">MKT_ACTIVITY_TARGET = #{mktActivityTarget,jdbcType=VARCHAR},</if>
        <if test= "mktCampaignDesc!=null">MKT_CAMPAIGN_DESC = #{mktCampaignDesc,jdbcType=VARCHAR},</if>
        <if test= "calcDisplay!=null">CALC_DISPLAY = #{calcDisplay,jdbcType=BIGINT},</if>
        <if test= "isaleDisplay!=null">ISALE_DISPLAY = #{isaleDisplay,jdbcType=BIGINT},</if>
        <if test= "execType!=null">EXEC_TYPE = #{execType,jdbcType=VARCHAR},</if>
        <if test= "execInvl!=null">EXEC_INVL = #{execInvl,jdbcType=VARCHAR},</if>
        <if test= "execNum!=null">EXEC_NUM = #{execNum,jdbcType=INTEGER},</if>
        <if test= "statusCd!=null">STATUS_CD = #{statusCd,jdbcType=VARCHAR},</if>
        <if test= "statusDate!=null">STATUS_DATE = #{statusDate,jdbcType=TIMESTAMP},</if>
        <if test= "createStaff!=null">CREATE_STAFF = #{createStaff,jdbcType=BIGINT},</if>
        <if test= "createDate!=null">CREATE_DATE = #{createDate,jdbcType=TIMESTAMP},</if>
        <if test= "updateStaff!=null">UPDATE_STAFF = #{updateStaff,jdbcType=BIGINT},</if>
        <if test= "remark!=null">REMARK = #{remark,jdbcType=VARCHAR},</if>
        <if test= "createChannel!=null">CREATE_CHANNEL = #{createChannel,jdbcType=VARCHAR},</if>
        <if test= "directoryId!=null">DIRECTORY_ID = #{directoryId,jdbcType=BIGINT},</if>
        <if test= "lanId!=null">LAN_ID = #{lanId,jdbcType=BIGINT},</if>
        <if test= "camLevel!=null">CAM_LEVEL = #{camLevel,jdbcType=BIGINT},</if>
        UPDATE_DATE = #{updateDate,jdbcType=TIMESTAMP}

    where MKT_CAMPAIGN_ID = #{mktCampaignId,jdbcType=BIGINT}
    </update>

    <select id="selectByPrimaryKey" parameterType="java.lang.Long" resultMap="BaseResultMap">
    select MKT_CAMPAIGN_ID, TIGGER_TYPE, MKT_CAMPAIGN_NAME, PLAN_BEGIN_TIME, PLAN_END_TIME,
    BEGIN_TIME, END_TIME, MKT_CAMPAIGN_TYPE, MKT_CAMPAIGN_CATEGORY, MKT_ACTIVITY_NBR,
    MKT_ACTIVITY_TARGET, MKT_CAMPAIGN_DESC, CALC_DISPLAY, ISALE_DISPLAY, EXEC_TYPE, EXEC_INVL, EXEC_NUM, STATUS_CD,
    STATUS_DATE, CREATE_STAFF, CREATE_DATE, UPDATE_STAFF, UPDATE_DATE, REMARK, LAN_ID, CREATE_CHANNEL, DIRECTORY_ID, CAM_LEVEL
    from mkt_campaign
    where MKT_CAMPAIGN_ID = #{mktCampaignId,jdbcType=BIGINT}
    </select>

    <select id="selectAll" resultMap="BaseResultMap">
    select MKT_CAMPAIGN_ID, TIGGER_TYPE, MKT_CAMPAIGN_NAME, PLAN_BEGIN_TIME, PLAN_END_TIME,
    BEGIN_TIME, END_TIME, MKT_CAMPAIGN_TYPE, MKT_CAMPAIGN_CATEGORY, MKT_ACTIVITY_NBR,
    MKT_ACTIVITY_TARGET, MKT_CAMPAIGN_DESC, CALC_DISPLAY, ISALE_DISPLAY, EXEC_TYPE, EXEC_INVL, EXEC_NUM, STATUS_CD,
    STATUS_DATE, CREATE_STAFF, CREATE_DATE, UPDATE_STAFF, UPDATE_DATE, REMARK, LAN_ID, CREATE_CHANNEL, DIRECTORY_ID, CAM_LEVEL
    from mkt_campaign order by UPDATE_DATE desc
    </select>


    <select id="qryMktCampaignListPage4Sync" parameterType="map" resultMap="countResultMap">
        select
        MKT_CAMPAIGN_ID, TIGGER_TYPE, MKT_CAMPAIGN_NAME, PLAN_BEGIN_TIME, PLAN_END_TIME,
        MKT_CAMPAIGN_TYPE,  MKT_CAMPAIGN_CATEGORY, MKT_ACTIVITY_NBR,  STATUS_CD, LAN_ID, CREATE_CHANNEL, CREATE_DATE,UPDATE_DATE
        from mkt_campaign
        where 1 = 1
        <if test="map.mktCampaignName != null and map.mktCampaignName != ''">
            AND MKT_CAMPAIGN_NAME like CONCAT('%',#{map.mktCampaignName,jdbcType=VARCHAR},'%')
        </if>
        <!--<if test="map.statusCd != null and map.statusCd != ''">-->
            <!--AND STATUS_CD = #{map.statusCd,jdbcType=VARCHAR}-->
        <!--</if>-->
        <if test="map.statusCd != null and map.statusCd == 1000">
            AND (STATUS_CD = 2002 or STATUS_CD = 2003)
        </if>
        <if test="map.statusCd != null and map.statusCd == 2000">
            AND STATUS_CD != 2002 and STATUS_CD != 2003
        </if>
        <if test="map.tiggerType != null and map.tiggerType != ''">
            AND TIGGER_TYPE = #{map.tiggerType,jdbcType=VARCHAR}
        </if>
        <if test="map.mktCampaignType != null and map.mktCampaignType != ''">
            AND MKT_CAMPAIGN_TYPE = #{map.mktCampaignType,jdbcType=VARCHAR}
        </if>
        <if test="map.mktCampaignCategory != null and map.mktCampaignCategory != ''">
            AND MKT_CAMPAIGN_CATEGORY = #{map.mktCampaignCategory,jdbcType=VARCHAR}
        </if>
        <if test="map.activityNbr != null and map.activityNbr != ''">
            AND MKT_ACTIVITY_NBR like CONCAT('%',#{map.activityNbr,jdbcType=VARCHAR},'%')
        </if>
        <if test="map.channel != null and map.channel != ''">
            AND CREATE_CHANNEL like CONCAT('%',#{map.channel,jdbcType=VARCHAR},'%')
        </if>
        AND STATUS_CD not in (2001,2003)
        order by UPDATE_DATE desc
    </select>



    <select id="qryMktCampaignListPage" parameterType="com.zjtelcom.cpct.domain.campaign.MktCampaignDO" resultMap="countResultMap">
        select MKT_CAMPAIGN_ID, TIGGER_TYPE, MKT_CAMPAIGN_NAME, PLAN_BEGIN_TIME, PLAN_END_TIME,
        MKT_CAMPAIGN_TYPE,  MKT_CAMPAIGN_CATEGORY, MKT_ACTIVITY_NBR,  STATUS_CD, LAN_ID, CREATE_CHANNEL, CREATE_DATE,
        (
            SELECT
              count(*)
            FROM
              mkt_campaign_rel r
            WHERE
                (
                  r.A_MKT_CAMPAIGN_ID = t.MKT_CAMPAIGN_ID
                  AND r.STATUS_CD = 1000
                  AND r.REL_TYPE = 1000
                )
                OR (
                  r.Z_MKT_CAMPAIGN_ID = t.MKT_CAMPAIGN_ID
                  AND r.STATUS_CD = 1000
                  AND r.REL_TYPE = 1000
                )
            ) AS REL_COUNT,
        (
            SELECT
            r.A_MKT_CAMPAIGN_ID
            FROM
            mkt_campaign_rel r
            WHERE
            t.MKT_CAMPAIGN_ID = r.Z_MKT_CAMPAIGN_ID
            ) AS A_MKT_CAMPAIGN_ID
              from mkt_campaign t
        where 1 = 1
        <if test="mktCampaignName != null and mktCampaignName != ''">
            AND t.MKT_CAMPAIGN_NAME like CONCAT('%',#{mktCampaignName,jdbcType=VARCHAR},'%')
        </if>
        <if test="statusCd != null and statusCd != ''">
            AND t.STATUS_CD = #{statusCd,jdbcType=VARCHAR}
        </if>
        <if test="tiggerType != null and tiggerType != ''">
            AND t.TIGGER_TYPE = #{tiggerType,jdbcType=VARCHAR}
        </if>
        <if test="mktCampaignCategory != null and mktCampaignCategory != ''">
            AND t.MKT_CAMPAIGN_CATEGORY = #{mktCampaignCategory,jdbcType=VARCHAR}
        </if>
        <if test="mktCampaignType != null and mktCampaignType != ''">
            AND t.MKT_CAMPAIGN_TYPE = #{mktCampaignType,jdbcType=VARCHAR}
        </if>
        <if test="lanId != null and lanId != ''">
            AND t.LAN_ID = #{lanId,jdbcType=BIGINT}
        </if>
        <if test="createChannel != null and createChannel != ''">
            AND t.CREATE_CHANNEL = #{createChannel,jdbcType=VARCHAR}
        </if>
        order by t.UPDATE_DATE desc
    </select>


    <update id="changeMktCampaignStatus">
        update mkt_campaign
        set STATUS_CD = #{statusCd,jdbcType=VARCHAR},
        UPDATE_STAFF = #{updateStaff,jdbcType=BIGINT},
        UPDATE_DATE = #{updateDate,jdbcType=TIMESTAMP}
        where MKT_CAMPAIGN_ID = #{mktCampaignId,jdbcType=BIGINT}
    </update>

    <select id="qryMktCampaignListByCondition" parameterType="com.zjtelcom.cpct.domain.campaign.MktCampaignDO" resultMap="BaseResultMap">
        select MKT_CAMPAIGN_ID, TIGGER_TYPE, MKT_CAMPAIGN_NAME, PLAN_BEGIN_TIME, PLAN_END_TIME,
        BEGIN_TIME, END_TIME, MKT_CAMPAIGN_TYPE, MKT_CAMPAIGN_CATEGORY, MKT_ACTIVITY_NBR, MKT_ACTIVITY_TARGET, MKT_CAMPAIGN_DESC,
        CALC_DISPLAY, ISALE_DISPLAY, EXEC_TYPE, EXEC_INVL, EXEC_NUM, STATUS_CD, STATUS_DATE, CREATE_STAFF, CREATE_DATE,
        UPDATE_STAFF, UPDATE_DATE, REMARK, LAN_ID, CREATE_CHANNEL, DIRECTORY_ID, CAM_LEVEL
        from mkt_campaign
        where 1 = 1
        <if test="mktCampaignId != null and mktCampaignId != ''">
            AND MKT_CAMPAIGN_ID = #{mktCampaignId,jdbcType=BIGINT}
        </if>
        <if test="mktCampaignName != null and mktCampaignName != ''">
            AND MKT_CAMPAIGN_NAME like CONCAT('%',#{mktCampaignName,jdbcType=VARCHAR},'%')
        </if>
        <if test="statusCd != null and statusCd != ''">
            AND STATUS_CD = #{statusCd,jdbcType=VARCHAR}
        </if>
        <if test="tiggerType != null and tiggerType != ''">
            AND TIGGER_TYPE = #{tiggerType,jdbcType=VARCHAR}
        </if>
        <if test="mktCampaignType != null and mktCampaignType != ''">
            AND MKT_CAMPAIGN_TYPE = #{mktCampaignType,jdbcType=VARCHAR}
        </if>
        <if test="planBeginTime != null and planBeginTime != ''">
            AND PLAN_BEGIN_TIME = #{planBeginTime,jdbcType=DATE}
        </if>
        <if test="PLAN_END_TIME != null and PLAN_END_TIME != ''">
            AND PLAN_END_TIME = #{PLAN_END_TIME,jdbcType=DATE}
        </if>
        <if test="mktCampaignCategory != null and mktCampaignCategory != ''">
            AND MKT_CAMPAIGN_CATEGORY = #{mktCampaignCategory,jdbcType=VARCHAR}
        </if>
        <if test="mktActivityNbr != null and mktActivityNbr != ''">
            AND MKT_ACTIVITY_NBR = #{mktActivityNbr,jdbcType=VARCHAR}
        </if>
        <if test="mktActivityTarget != null and mktActivityTarget != ''">
            AND MKT_ACTIVITY_TARGET like CONCAT('%',#{mktActivityTarget,jdbcType=VARCHAR},'%')
        </if>
        <if test="mktCampaignDesc != mktCampaignDesc and statusCd != ''">
            AND mktCampaignDesc like CONCAT('%',#{mktCampaignDesc,jdbcType=VARCHAR},'%')
        </if>
        <if test="calcDisplay != null and calcDisplay != 0">
            AND CALC_DISPLAY = #{calcDisplay,jdbcType=BIGINT}
        </if>
        <if test="isaleDisplay != null and isaleDisplay != 0">
            AND ISALE_DISPLAY = #{isaleDisplay,jdbcType=BIGINT}
        </if>
        <if test="statusDate != null">
            AND STATUS_DATE = #{statusDate,jdbcType=TIMESTAMP}
        </if>
        <if test="createStaff != null and createStaff != ''">
            AND CREATE_STAFF = #{createStaff,jdbcType=BIGINT}
        </if>
        <if test="createDate != null">
            AND CREATE_DATE = #{statusCd,jdbcType=TIMESTAMP}
        </if>
        <if test="updateStaff != null and updateStaff != ''">
            AND UPDATE_STAFF = #{updateStaff,jdbcType=BIGINT}
        </if>
        <if test="updateDate != null">
            AND UPDATE_DATE = #{statusCd,jdbcType=TIMESTAMP}
        </if>
        <if test="createChannel != null and createChannel != ''">
            AND CREATE_CHANNEL = #{createChannel,jdbcType=VARCHAR}
        </if>
        <if test="directoryId != null and directoryId != ''">
            AND DIRECTORY_ID = #{directoryId,jdbcType=BIGINT}
        </if>
        <if test="camLevel != null and camLevel != ''">
            AND CAM_LEVEL = #{camLevel,jdbcType=BIGINT}
        </if>
        order by UPDATE_DATE desc
    </select>
</mapper>